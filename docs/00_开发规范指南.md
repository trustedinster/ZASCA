# ZASCA 项目开发与重构实施指南 V3.0
**文档性质**：强制执行标准  
**适用对象**：全体后端及前端开发人员  
**生效日期**：即日起  
**核心目标**：根治"屎山"代码，统一文档，简化架构，提升系统安全性与稳定性。

---

## 1. 开发基础规范：环境与 Git 卫生（立即执行）

鉴于项目当前存在大量测试文件遗留和隐私泄露风险，这是第一道防线，必须立即执行。

### 1.1 `.gitignore` 强制规范

**严禁**将任何测试文件、临时文件、隐私配置提交到 Git 仓库。请立即检查并更新项目根目录的 `.gitignore`，确保包含以下内容：

```gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
*.egg-info/
dist/
build/

# 环境与隐私 (严禁提交)
.env
.env.local
*.sqlite3
db.sqlite3
config/secret_settings.py

# 测试与临时文件 (严禁提交，用完即删)
test_*.py
check_*.py
tmp_*.py
debug_*.py
*.log

# 系统文件
.DS_Store
Thumbs.db

# IDE
.vscode/
.idea/
*.swp
*.swo
```

**Git 工作流要求：**
1. **及时提交**：完成一个小功能或修复一个 Bug，必须立即 `git add` + `git commit`。禁止攒了一周代码最后一次性提交。
2. **清理历史**：如果仓库里已经存在大量 `test_xxx.py`，必须进行一次清理提交，将其移除。

---

## 2. 后端开发哲学：Django-Admin 优先（核心原则）

为了防止程序员为了炫技或"更灵活"而造轮子，导致代码库膨胀，制定以下铁律：

### 2.1 管理员后台开发原则

**核心原则**：**能不写自定义 View，就坚决不写。** 优先使用 Django Admin 自带的强大功能。

* **首选方案**：在 `admin.py` 中深度配置。
  * 利用 `list_display`, `list_filter`, `search_fields` 优化列表页。
  * 利用 `actions` 实现批量操作（如批量审核工单）。
  * 利用 `inlines` 实现主子表管理（如主机详情页直接显示其下的工单）。

* **次选方案**：Admin 覆盖模板或注入 JS。
  * 仅需修改前端交互（如点击按钮弹窗确认）时，使用 `Media` 类注入 JS，或覆盖 `change_form.html`。

* **最后方案**：创建自定义 View（`urls.py` + `views.py`）。
  * **触发条件**：只有当业务流程极其复杂，无法通过表单和列表页表达时（例如：高度可视化的拓扑图、极其复杂的向导式流程），才允许申请创建自定义视图。

### 2.2 严禁事项

* 禁止为了"增删改查"这种基础 CRUD 功能写一套独立的 HTML 模板和 View。如果 Admin 能做，必须用 Admin。
* 禁止重复造轮子：已有 Django Admin 功能的，不得重新实现。

---

## 3. 前端开发标准：Material Design 3 (MD3)

用户前台（非后台）需要自行开发，但必须遵循统一的设计语言，拒绝五花八门的样式。

### 3.1 设计规范

* **设计系统**：全站采用 **Material Design 3** 规范。
* **视觉风格**：大圆角、动态配色、状态层、清晰的排版层级。
* **响应式**：必须适配移动端和桌面端。

### 3.2 组件化要求

* 程序员构建的组件（按钮、卡片、输入框、导航栏）必须符合 MD3 规范。
* **颜色板**：统一使用一套 CSS 变量定义主色调（Primary）、次色调（Secondary）、背景色等，严禁硬编码颜色值。

### 3.3 极简主义原则

根据用户偏好，所有模态框实现应极度简化，避免复杂设计和多余代码，追求"简简单单"的功能实现，反对"花里胡哨"的视觉效果。

---

## 4. 文档规范：单一事实来源

针对客户吐槽的"文档东一处西一处、版本老旧、互相矛盾"，实施以下文档管理策略：

### 4.1 文档存放位置

**所有技术文档必须集中在项目根目录的 `docs/` 文件夹下**，严禁散落在代码注释、Wiki、本地 Readme 或云笔记中。

**推荐目录结构：**
```
ZASCA/
├── docs/
│   ├── 01_项目架构与设计.md      # 架构图、技术选型理由
│   ├── 02_API接口文档.md         # 自动生成或手动维护的接口定义
│   ├── 03_Database_Schema.md     # 数据模型关系图
│   ├── 04_部署运维手册.md         # 部署步骤、环境变量说明
│   ├── 05_更新日志.md            # 版本迭代记录
│   └── 06_安全配置指南.md         # 安全策略、权限管理说明
└── README.md                     # 仅保留简单的介绍和快速开始
```

### 4.2 文档维护原则

* **代码变动，文档先行**：如果修改了 Model 结构，必须同步更新 `03_Database_Schema.md`。
* **去重**：删除所有过时的 Readme 文件，确保 `docs/` 里的文档是唯一最新的。
* **代码注释替代**：不要把文档写在 Word 里。复杂的业务逻辑直接在代码中写清晰的 Docstring（遵循 Google Style），通过生成工具（如 Sphinx）产出文档。

### 4.3 文档内容隔离原则

设计文档中应严格隔离H端与C端概念，仅保留H端初始化相关的内容模型，禁止包含C端生成工具等实现细节，确保文档聚焦于目标端的核心流程。

---

## 5. 实施路线图：分步骤，分轻重缓急

为了避免混乱，请严格按照以下顺序推进工作。不要并行开发多个互不相干的功能。

### 第一阶段：环境与代码清理（P0 - 最高优先级）

1. **清理代码**：删除项目中所有的 `test_xxx.py`, `check_xxx.py`。
2. **配置 Git**：完善 `.gitignore`，清理仓库历史。
3. **安全审计**：检查 `.env` 文件是否已纳入版本控制（如有，立即撤销并修改密码）。
4. **建立 docs 目录**：创建标准化文档结构。

### 第二阶段：核心功能重构（P1 - 业务核心）

基于产品导向的设计理念，使用 Django Admin 实现。

1. **Product 模型 Admin**：实现产品信息管理、可用性控制。
2. **Ticket/工单 Admin**：实现开户申请的审核和管理。
3. **验收**：超级管理员和普通管理员登录 `/admin/`，验证产品和工单管理功能正常。

### 第三阶段：前端 MD3 改造（P2 - 用户体验）

在 Admin 稳定运行后，开始升级用户前台。

1. **搭建基础框架**：引入 MD3 CSS 框架（或自定义实现）。
2. **组件库建设**：封装 Button, Card, Input 等基础组件。
3. **页面迁移**：将"用户开户"、"我的云电脑"等页面逐步迁移至新风格。

### 第四阶段：文档与交付（P3 - 闭环）

1. **完善 `docs/`**：补全架构图、API 文档。
2. **部署手册**：编写基于 Docker 或标准虚拟机的部署文档。
3. **演示环境**：确保 Demo 模式下的所有功能正常。

---

## 6. 程序员自查清单

在代码合并请求（Pull Request）发出前，请确认：

* [ ] 我有没有为了这个功能写自定义 View？能不能用 Admin 实现？
* [ ] 我的代码里有没有遗留的 `test_` 或 `print()` 调试语句？
* [ ] 我修改了 Model 或 API，有没有更新 `docs/` 下的对应文档？
* [ ] 前端页面是否符合 Material Design 3 的圆角和间距规范？
* [ ] 是否确认过 `.gitignore` 忽略了敏感信息？
* [ ] 我的代码变更是否遵循了极简主义设计原则？
* [ ] 文档是否保持了H端与C端概念的严格隔离？

---

## 7. 技术债务管理

### 7.1 现有技术债务识别

对项目进行全面的技术债务审计，识别以下问题：
- 重复代码块
- 过长函数/方法
- 过深嵌套
- 缺失测试覆盖率
- 不规范的命名约定

### 7.2 债务偿还计划

建立技术债务偿还机制：
1. 每个 Sprint 分配 20% 时间用于技术债务偿还
2. 新功能开发必须考虑现有架构的兼容性
3. 重大重构需要经过架构评审

---

## 8. 代码质量保障

### 8.1 代码审查标准

所有代码提交必须经过同行评审，重点关注：
- 是否遵循 Django-Admin 优先原则
- 前端是否符合 MD3 规范
- 是否有足够的测试覆盖
- 文档是否同步更新

### 8.2 自动化检查

配置 CI/CD 流水线，包含：
- 代码风格检查（flake8, black）
- 安全扫描
- 单元测试执行
- 文档完整性检查

---

**结语：**

ZASCA 是一个优秀的零代理工具，不应该因为代码管理问题被客户诟病。请各位同事务必遵守上述规范，用代码质量赢得客户的信任。

---
*文档版本：V3.0*  
*最后更新：2026年2月3日*