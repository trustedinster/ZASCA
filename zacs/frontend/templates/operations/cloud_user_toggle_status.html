{% extends 'base.html' %}
{% load static %}

{% block title %}切换用户状态 - ZASCA{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/operations.css' %}">
{% endblock %}

{% block content %}
<div class="container operations-page">
    <div class="page-header">
        <h1>切换云电脑用户状态</h1>
    </div>

    <div class="card">
        <div class="card-body">
            <h5 class="card-title">用户信息</h5>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>用户名:</strong> {{ cloud_user.username }}</p>
                    <p><strong>用户姓名:</strong> {{ cloud_user.fullname }}</p>
                    <p><strong>邮箱:</strong> {{ cloud_user.email }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>所属主机:</strong> {{ cloud_user.host.name }}</p>
                    <p><strong>当前状态:</strong> 
                        <span class="badge bg-{{ cloud_user.status == 'active' and 'success' or cloud_user.status == 'inactive' and 'warning' or 'danger' }}">
                            {{ cloud_user.get_status_display }}
                        </span>
                    </p>
                    <p><strong>创建时间:</strong> {{ cloud_user.created_at|date:"Y-m-d H:i:s" }}</p>
                </div>
            </div>

            <form method="post" class="mt-4">
                {% csrf_token %}
                
                <div class="alert alert-warning" role="alert">
                    <h6>警告</h6>
                    <p>您即将更改云电脑用户的状态。请确认操作：</p>
                    <ul>
                        <li><strong>激活用户:</strong> 用户将能够正常登录和使用系统</li>
                        <li><strong>停用用户:</strong> 用户将无法登录系统，但账户仍存在</li>
                        <li><strong>禁用用户:</strong> 用户将被禁用，可能影响相关服务</li>
                        <li><strong>删除用户:</strong> 用户将被标记为删除状态，但不会立即从系统中移除</li>
                    </ul>
                </div>

                <div class="mt-4">
                    <button type="submit" name="action" value="activate" class="btn btn-success me-2">激活用户</button>
                    <button type="submit" name="action" value="deactivate" class="btn btn-warning me-2">停用用户</button>
                    <button type="submit" name="action" value="disable" class="btn btn-danger me-2">禁用用户</button>
                    <button type="submit" name="action" value="delete" class="btn btn-danger">删除用户</button>
                    <a href="{% url 'operations:cloud_user_list' %}" class="btn btn-secondary">取消</a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// 添加确认对话框
document.querySelectorAll('button[type="submit"]').forEach(button => {
    button.addEventListener('click', function(e) {
        const action = this.value;
        let actionText = '';
        switch(action) {
            case 'activate':
                actionText = '激活';
                break;
            case 'deactivate':
                actionText = '停用';
                break;
            case 'disable':
                actionText = '禁用';
                break;
            case 'delete':
                actionText = '删除';
                break;
        }
        
        if (!confirm(`确认要${actionText}用户 "${this.closest('form').querySelector('[name="cloud_user"]').textContent || '{{ cloud_user.username }}'}" 吗？此操作可能会影响用户的正常使用。`)) {
            e.preventDefault();
        }
    });
});
</script>
{% endblock %}